<%- include('../includes/header') %>

    <!-- ============================================================== -->
    <!-- Bread crumb and right sidebar toggle -->
    <!-- ============================================================== -->
    <div class="page-breadcrumb">
        <div class="row">
            <div class="col-5 align-self-center">
                <h4 class="page-title">Doanh Số Hệ Thống Chính</h4>
            </div>
            <div class="col-7 align-self-center">
                <div class="d-flex align-items-center justify-content-end">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item">
                                <a href="#">Home</a>
                            </li>
                            <li class="breadcrumb-item active" aria-current="page">
                                Dashboard
                            </li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>
    </div>
    <!-- ============================================================== -->
    <!-- End Bread crumb and right sidebar toggle -->
    <!-- ============================================================== -->




    <!-- ============================================================== -->
    <!-- Container fluid  -->
    <!-- ============================================================== -->
    <div class="container-fluid">
        <!-- ============================================================== -->
        <!-- Sales chart -->
        <!-- ============================================================== -->
        <div class="col-md-8 row" style="margin-bottom:10px;">
            <div class="col-md-4 row" style="margin-bottom: 10px;">
                <h6 class="card-subtitle">Thời gian từ
                </h6>
                <div class="input-group">
                    <input type="text" name="inputDashboardFrom" class="form-control mydatepicker"
                        placeholder="mm/dd/yyyy">
                    <span class="input-group-text">
                        <i class="fas fa-calendar-alt"></i>
                    </span>
                </div>
            </div>
            <div class="col-md-4 row" style="margin-bottom: 10px;">
                <h6 class="card-subtitle">Thời gian đến
                </h6>
                <div class="input-group">
                    <input type="text" name="inputDashboardTo" class="form-control mydatepicker"
                        placeholder="mm/dd/yyyy">
                    <span class="input-group-text">
                        <i class="fas fa-calendar-alt"></i>
                    </span>
                </div>
            </div>
            <div class="col-md-2 row">
                <button onclick="getStatisSystem()" type="button" class="btn waves-effect waves-light btn-secondary"
                    style="height: 30px;margin-top: 11px;">
                    Kiểm tra
                </button>
            </div>
        </div>


        <div class="row">
            <div class="col-lg-3 col-md-6">
                <div class="card border-bottom border-info">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div>
                                <h2 id="dashboard-total-deposit">0</h2>
                                <h6 class="text-info mb-0">Tổng Nạp (VND)</h6>
                            </div>
                            <div class="ms-auto">
                                <span class="text-info display-6"><i class="fas fa-shopping-cart"></i></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="card border-bottom border-primary">
                    <div class="card-body">
                        <div class="d-flex no-block align-items-center">
                            <div>
                                <h2 id="dashboard-total-withdraw">0</h2>
                                <h6 class="text-primary mb-0">Tổng Rút (VND)</h6>
                            </div>
                            <div class="ms-auto">
                                <span class="text-primary display-6"><i class="fas fa-tags"></i></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="card border-bottom border-success">
                    <div class="card-body">
                        <div class="d-flex no-block align-items-center">
                            <div>
                                <h2 id="dashboard-total-profit">0</h2>
                                <h6 class="text-success mb-0">Lợi nhuận (VND)</h6>
                            </div>
                            <div class="ms-auto">
                                <span class="text-success display-6">
                                    <i class="fas fa-shipping-fast"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="card border-bottom border-orange">
                    <div class="card-body">
                        <div class="d-flex no-block align-items-center">
                            <div>
                                <h2 id="dashboard-total-volume">0</h2>
                                <h6 class="text-orange mb-0">Tổng Volume Giao Dịch (Điểm)</h6>
                            </div>
                            <div class="ms-auto">
                                <span class="text-orange display-6"><svg xmlns="http://www.w3.org/2000/svg" width="24"
                                        height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                        class="feather feather-pie-chart feather-xl">
                                        <path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path>
                                        <path d="M22 12A10 10 0 0 0 12 2v10z"></path>
                                    </svg></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- ============================================================== -->
        <!-- Ravenue - page-view-bounce rate -->
        <!-- ============================================================== -->


        <div class="row">
            <div class="col-lg-3 col-md-6">
                <div class="card border-start border-orange">
                    <div class="card-body">
                        <div class="d-flex no-block align-items-center">
                            <div>
                                <span class="text-orange display-6">
                                    <i class="fas fa-users"></i>
                                </span>
                            </div>
                            <div class="ms-auto">
                                <h2 id="dashboard-total-user" style="text-align: right;">0</h2>
                                <h6 class="text-orange mb-0">Tổng số thành viên hệ thống</h6>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="card border-start border-info">
                    <div class="card-body">
                        <div class="d-flex no-block align-items-center">
                            <div>
                                <span class="text-info display-6">
                                    <i class="fas fa-user-secret"></i>
                                </span>
                            </div>
                            <div class="ms-auto">
                                <h2 id="dashboard-total-user-agency" style="text-align: right;">0</h2>
                                <h6 class="text-info mb-0">Tổng số thành viên là đại lý</h6>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="card border-start border-cyan">
                    <div class="card-body">
                        <div class="d-flex no-block align-items-center">
                            <div>
                                <span class="text-cyan display-6">
                                    <i class="fas fa-user-plus"></i>
                                </span>
                            </div>
                            <div class="ms-auto">
                                <h2 id="dashboard-total-register-by-agenccy" style="text-align: right;">0</h2>
                                <h6 class="text-cyan mb-0">Thành viên đăng ký qua đại lý</h6>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="card border-start border-success">
                    <div class="card-body">
                        <div class="d-flex no-block align-items-center">
                            <div>
                                <span class="text-success display-6">
                                    <i class="fas fa-sitemap"></i>
                                </span>
                            </div>
                            <div class="ms-auto">
                                <h2 id="dashboard-total-commission" style="text-align: right;">0</h2>
                                <h6 class="text-success mb-0">Hoa hồng thực tế (VND)</h6>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-3 col-md-6">
                <div class="card border-top border-cyan">
                    <div class="card-body">
                        <div class="d-flex no-block align-items-center">
                            <div>
                                <h2 id="totalSumBalance">0</h2>
                                <h6 class="text-cyan mb-0">Tổng số dư của thành viên</h6>
                            </div>
                            <div class="ms-auto">
                                <span class="text-cyan display-6">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="feather feather-dollar-sign feather-xl">
                                        <line x1="12" y1="1" x2="12" y2="23"></line>
                                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                    </svg>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="card border-top border-primary">
                    <div class="card-body">
                        <div class="d-flex no-block align-items-center">
                            <div>
                                <h2 id="dashboard-total-playProfit">0</h2>
                                <h6 class="text-primary mb-0">Tổng thắng thua thành viên (Điểm)</h6>
                            </div>
                            <div class="ms-auto">
                                <span class="text-primary display-6">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="feather feather-dollar-sign feather-xl">
                                        <line x1="12" y1="1" x2="12" y2="23"></line>
                                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                    </svg>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="card border-top border-primary">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="d-flex no-block align-items-center">
                                    <div>
                                        <i class="ri-bar-chart-fill fs-6 text-muted"></i>
                                        <p class="fs-4 mb-1">Người chơi đang Online</p>
                                    </div>
                                    <div class="ms-auto">
                                        <h1 class="fw-light text-end" id="users-online">0</h1>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="progress">
                                    <div class="progress-bar bg-info" role="progressbar" style="width: 75%; height: 6px"
                                        aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="card border-top border-primary">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="d-flex no-block align-items-center">
                                    <div>
                                        <i class="ri-money-euro-circle-line fs-6 text-muted"></i>
                                        <p class="fs-4 mb-1">Agency đang Online</p>
                                    </div>
                                    <div class="ms-auto">
                                        <h1 class="fw-light text-end" id="agency-online">0</h1>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="progress">
                                    <div class="progress-bar bg-success" role="progressbar"
                                        style="width: 60%; height: 6px" aria-valuenow="25" aria-valuemin="0"
                                        aria-valuemax="100"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <!-- ============================================================== -->
    <!-- End Container fluid  -->
    <!-- ============================================================== -->
    <!-- ============================================================== -->



    <script>
        $(document).ready(() => {
            // Set default value
            $('input[name="inputDashboardFrom"]').val(moment().format("DD/MM/YYYY"));
            $('input[name="inputDashboardTo"]').val(moment().format("DD/MM/YYYY"));

            // Date Picker  
            $('input[name="inputDashboardFrom"]').datepicker({
                language: 'vi',
                autoclose: true,
                todayHighlight: true,
            });
            $('input[name="inputDashboardTo"]').datepicker({
                language: 'vi',
                autoclose: true,
                todayHighlight: true,
            });

            // call system statis
            getStatisSystem();
            // call system caculate
            getCalculateSystem();
            // call sum user and agency sum balance
            getTotalSumBalance();
        });

        const getStatisSystem = () => {
            loadingStatus(true);
            $.ajax({
                "url": '<%=dataPage.config.API_SERVER%>/dashboard/statis?from=' + $('input[name="inputDashboardFrom"]').val() + '&to=' + $('input[name="inputDashboardTo"]').val(),
                "method": "GET",
                "timeout": 0,
                "headers": {
                    "Authorization": "Bearer <%=dataPage.session.accessToken%>",
                },
            }).then((response) => {
                loadingStatus(false);
                let totalCommission = 0;
                let percentMultiply = 0;

                if (response.status) {
                    $('#dashboard-total-deposit').html(numberWithCommas(response.data.totalDeposit));
                    $('#dashboard-total-withdraw').html(numberWithCommas(response.data.totalWithdraw));
                    $('#dashboard-total-profit').html(numberWithCommas(response.data.totalProfit));
                    $('#dashboard-total-volume').html(numberWithCommas(response.data.totalVolumeBet));
                    $('#dashboard-total-playProfit').html(numberWithCommas(response.data.totalPlayProfit));

                    // Tính hoa hồng
                    //console.log(response.data.totalPlayProfit);
                    if (response.data.totalPlayProfit < 0) {
                        totalCommission = (response.data.totalPlayProfit * 80) / 100;

                        totalCommission = totalCommission * 1000;
                        percentMultiply = 40;
                        // if (response.data.totalDeposit > 0 && response.data.totalDeposit <= 500000000) {
                        //     percentMultiply = 20;
                        // } else if (response.data.totalDeposit > 500000000 && response.data.totalDeposit <= 1500000000) {
                        //     percentMultiply = 30;
                        // } else if (response.data.totalDeposit > 1500000000) {
                        //     percentMultiply = 40;
                        // }

                        totalCommission = (totalCommission * percentMultiply) / 100;
                        //console.log(totalCommission);
                        //console.log(totalCommission);
                        $("#dashboard-total-commission").html(numberWithCommas(-totalCommission));
                    } else { }

                } else {
                    console.log(response);
                }
            });
        }

        const getCalculateSystem = () => {
            $.ajax({
                "url": '<%=dataPage.config.API_SERVER%>/dashboard/calculate',
                "method": "GET",
                "timeout": 0,
                "headers": {
                    "Authorization": "Bearer <%=dataPage.session.accessToken%>",
                },
            }).then((response) => {
                if (response.status) {
                    $('#dashboard-total-user').html(numberWithCommas(response.data.totalSystemUser));
                    $('#dashboard-total-user-agency').html(numberWithCommas(response.data.totalSystemUserIsAgency));
                    $('#dashboard-total-register-by-agenccy').html(numberWithCommas(response.data.totalSystemUserRegisterByAgency));
                    //$('#dashboard-total-subsystem').html(numberWithCommas(response.data.totalSystemUser));
                } else {
                    console.log(response);
                }
            });
        }

        const getTotalSumBalance = () => {
            $.ajax({
                "url": '<%=dataPage.config.API_SERVER%>/dashboard/sum-balance',
                "method": "GET",
                "timeout": 0,
                "headers": {
                    "Authorization": "Bearer <%=dataPage.session.accessToken%>",
                },
            }).then((response) => {
                if (response.status) {
                    $('#totalSumBalance').html(numberWithCommas(response.totalCoin));
                } else {
                    console.log(response);
                }
            });
        }

        // get online 
        socketSend({ action: { dashboard: { getOnline: true } } });

    </script>



    <%- include('../includes/footer') %>